以下は設計確定済みの修正指示です。
判断・設計変更・改善提案は行わず、指定された内容のみを実装してください。

・指示されていないコードは変更しない
・beforeinput は触らない
・Firestore への新規アクセスは追加しない
・criteriaState.ready === true を前提にする